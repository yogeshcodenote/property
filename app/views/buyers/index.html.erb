<div class="mb-8">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-bold tracking-tight text-slate-900">Buyer Directory</h2>
      <p class="text-slate-500 mt-1">Manage and track all property buyers in your portfolio.</p>
    </div>
    <div class="flex gap-3">
      <button class="btn-secondary flex items-center gap-2">
        <span class="material-symbols-outlined">download</span>
        Export CSV
      </button>
      <%= link_to new_buyer_path, class: "btn-primary flex items-center gap-2" do %>
        <span class="material-symbols-outlined">person_add</span>
        Add Buyer
      <% end %>
    </div>
  </div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="card p-6">
    <p class="text-xs text-slate-500 uppercase tracking-wider">Total Buyers</p>
    <p class="text-3xl font-bold text-slate-900 mt-2"><%= @buyers.count %></p>
  </div>
  <div class="card p-6">
    <p class="text-xs text-slate-500 uppercase tracking-wider">New This Month</p>
    <p class="text-3xl font-bold text-green-600 mt-2">+<%= @buyers.where('created_at >= ?', 1.month.ago).count %></p>
  </div>
  <div class="card p-6">
    <p class="text-xs text-slate-500 uppercase tracking-wider">Total Sales Volume</p>
    <p class="text-3xl font-bold text-slate-900 mt-2">₹<%= number_with_delimiter(@buyers.sum(:sale_price)) %></p>
  </div>
  <div class="card p-6">
    <p class="text-xs text-slate-500 uppercase tracking-wider">Avg. Sale Price</p>
    <p class="text-3xl font-bold text-slate-900 mt-2">₹<%= number_with_delimiter(@buyers.average(:sale_price).to_i) if @buyers.any? %></p>
  </div>
</div>

<!-- Buyers Table -->
<div class="card overflow-hidden">
  <table class="w-full">
    <thead class="bg-slate-50 border-b border-slate-200">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Buyer Name</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Phone</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Property Purchased</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Sale Price</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Purchase Date</th>
        <th class="px-6 py-3 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-100">
      <% @buyers.each do |buyer| %>
        <tr class="hover:bg-slate-50 transition-colors">
          <td class="px-6 py-4">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center">
                <span class="text-xs font-semibold text-slate-600"><%= buyer.name.split.map(&:first).join %></span>
              </div>
              <span class="text-sm font-medium text-slate-900"><%= buyer.name %></span>
            </div>
          </td>
          <td class="px-6 py-4">
            <span class="text-sm text-slate-600"><%= buyer.phone %></span>
          </td>
          <td class="px-6 py-4">
            <%= link_to property_path(buyer.property), class: "flex items-center gap-2 text-sm text-green-600 hover:text-green-700" do %>
              <span class="material-symbols-outlined text-sm">location_on</span>
              <%= buyer.property.plot_number %> - <%= buyer.property.title %>
            <% end %>
          </td>
          <td class="px-6 py-4">
            <span class="text-sm font-semibold text-slate-900">₹<%= number_with_delimiter(buyer.sale_price) %></span>
          </td>
          <td class="px-6 py-4">
            <span class="text-sm text-slate-600"><%= buyer.purchase_date&.strftime("%b %d, %Y") || "N/A" %></span>
          </td>
          <td class="px-6 py-4">
            <div class="flex items-center justify-end gap-2">
              <%= link_to buyer_path(buyer), class: "p-2 hover:bg-slate-100 rounded-lg transition-colors", title: "View" do %>
                <span class="material-symbols-outlined text-slate-600">visibility</span>
              <% end %>
              <%= link_to edit_buyer_path(buyer), class: "p-2 hover:bg-slate-100 rounded-lg transition-colors", title: "Edit" do %>
                <span class="material-symbols-outlined text-slate-600">edit</span>
              <% end %>
              <%= button_to buyer_path(buyer), method: :delete, class: "p-2 hover:bg-red-50 rounded-lg transition-colors", 
                  data: { confirm: "Are you sure?" }, title: "Delete" do %>
                <span class="material-symbols-outlined text-red-600">delete</span>
              <% end %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <% if @buyers.empty? %>
    <div class="p-12 text-center">
      <span class="material-symbols-outlined text-slate-300 text-6xl mb-4">group</span>
      <p class="text-slate-500">No buyers found. Add a buyer when a property is sold.</p>
      <%= link_to new_buyer_path, class: "btn-primary mt-4 inline-flex items-center gap-2" do %>
        <span class="material-symbols-outlined">person_add</span>
        Add Buyer
      <% end %>
    </div>
  <% end %>
</div>
