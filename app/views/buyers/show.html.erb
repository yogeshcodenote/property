<div class="mb-8">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-bold tracking-tight text-slate-900"><%= @buyer.name %></h2>
      <p class="text-slate-500 mt-1">
        <span class="material-symbols-outlined text-sm align-middle">phone</span>
        <%= @buyer.phone %>
      </p>
    </div>
    <div class="flex gap-3">
      <%= link_to edit_buyer_path(@buyer), class: "btn-secondary flex items-center gap-2" do %>
        <span class="material-symbols-outlined">edit</span>
        Edit Details
      <% end %>
      <%= link_to buyers_path, class: "btn-secondary flex items-center gap-2" do %>
        <span class="material-symbols-outlined">arrow_back</span>
        Back
      <% end %>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Main Content -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Buyer Profile Card -->
    <div class="card overflow-hidden">
      <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-8">
        <div class="flex items-center gap-6">
          <div class="w-24 h-24 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border-4 border-white/30">
            <span class="text-3xl font-bold text-white"><%= @buyer.name.split.map(&:first).join %></span>
          </div>
          <div class="text-white">
            <h1 class="text-3xl font-bold mb-2"><%= @buyer.name %></h1>
            <div class="flex items-center gap-4 text-sm text-white/90">
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">phone</span>
                <%= @buyer.phone %>
              </div>
              <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">calendar_today</span>
                Customer since <%= @buyer.created_at.strftime("%b %Y") %>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 bg-slate-50 rounded-xl">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-outlined text-slate-400 text-sm">badge</span>
              <p class="text-xs text-slate-500 uppercase tracking-wider">Buyer ID</p>
            </div>
            <p class="text-lg font-bold text-slate-900">#<%= @buyer.id %></p>
          </div>
          
          <div class="p-4 bg-slate-50 rounded-xl">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-outlined text-slate-400 text-sm">calendar_today</span>
              <p class="text-xs text-slate-500 uppercase tracking-wider">Purchase Date</p>
            </div>
            <p class="text-lg font-bold text-slate-900"><%= @buyer.purchase_date&.strftime("%d %b %Y") || "N/A" %></p>
          </div>
          
          <div class="p-4 bg-slate-50 rounded-xl">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-outlined text-slate-400 text-sm">verified</span>
              <p class="text-xs text-slate-500 uppercase tracking-wider">Status</p>
            </div>
            <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-700">
              <span class="w-2 h-2 rounded-full bg-green-500"></span>
              Verified Buyer
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Property Purchased -->
    <div class="card p-6">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-green-600">home</span>
        </div>
        <h3 class="text-lg font-semibold text-slate-900">Property Purchased</h3>
      </div>
      
      <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
        <div class="flex items-start justify-between mb-4">
          <div>
            <h4 class="text-xl font-bold text-slate-900 mb-1"><%= @buyer.property.title %></h4>
            <p class="text-slate-500 flex items-center gap-1">
              <span class="material-symbols-outlined text-sm">location_on</span>
              <%= @buyer.property.colony_name %> - Plot <%= @buyer.property.plot_number %>
            </p>
          </div>
          <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-semibold bg-red-100 text-red-700">
            <span class="material-symbols-outlined text-sm">sell</span>
            Sold
          </span>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-6">
          <div class="p-3 bg-white rounded-lg border border-green-100">
            <p class="text-xs text-slate-500 mb-1">Size</p>
            <p class="text-lg font-bold text-slate-900"><%= number_with_delimiter(@buyer.property.size) %> <span class="text-sm font-normal">sq ft</span></p>
          </div>
          <div class="p-3 bg-white rounded-lg border border-green-100">
            <p class="text-xs text-slate-500 mb-1">Status</p>
            <p class="text-lg font-bold text-slate-900"><%= @buyer.property.status.capitalize %></p>
          </div>
          <div class="p-3 bg-white rounded-lg border border-green-100">
            <p class="text-xs text-slate-500 mb-1">Listing Price</p>
            <p class="text-lg font-bold text-green-600">₹<%= number_with_delimiter(@buyer.property.price) %></p>
          </div>
        </div>
        
        <div class="mt-4">
          <%= link_to property_path(@buyer.property), class: "btn-primary inline-flex items-center gap-2" do %>
            <span class="material-symbols-outlined">visibility</span>
            View Property Details
          <% end %>
        </div>
      </div>
    </div>

    <!-- Sale Details -->
    <div class="card p-6">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-blue-600">payments</span>
        </div>
        <h3 class="text-lg font-semibold text-slate-900">Sale Information</h3>
      </div>
      
      <div class="space-y-4">
        <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
              <span class="material-symbols-outlined text-green-600">currency_rupee</span>
            </div>
            <div>
              <p class="text-sm font-medium text-slate-700">Sale Price</p>
              <p class="text-xs text-slate-500">Final transaction amount</p>
            </div>
          </div>
          <p class="text-2xl font-bold text-green-600">₹<%= number_with_delimiter(@buyer.sale_price) %></p>
        </div>
        
        <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
              <span class="material-symbols-outlined text-blue-600">event</span>
            </div>
            <div>
              <p class="text-sm font-medium text-slate-700">Purchase Date</p>
              <p class="text-xs text-slate-500">Date of transaction</p>
            </div>
          </div>
          <p class="text-lg font-bold text-slate-900"><%= @buyer.purchase_date&.strftime("%d %B %Y") || "Not set" %></p>
        </div>
      </div>
    </div>

    <!-- Customer Review -->
    <% if @buyer.review.present? %>
      <div class="card p-6">
        <div class="flex items-center gap-3 mb-6">
          <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
            <span class="material-symbols-outlined text-yellow-600">rate_review</span>
          </div>
          <h3 class="text-lg font-semibold text-slate-900">Customer Review</h3>
        </div>
        
        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
          <div class="flex items-start gap-4">
            <div class="w-10 h-10 rounded-full bg-yellow-200 flex items-center justify-center flex-shrink-0">
              <span class="material-symbols-outlined text-yellow-700">format_quote</span>
            </div>
            <div>
              <p class="text-slate-700 leading-relaxed italic"><%= simple_format(@buyer.review) %></p>
              <div class="mt-4 flex items-center gap-2">
                <div class="flex text-yellow-500">
                  <% 5.times do %>
                    <span class="material-symbols-outlined text-sm">star</span>
                  <% end %>
                </div>
                <span class="text-xs text-slate-500">Verified Purchase</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Sidebar -->
  <div class="space-y-6">
    <!-- Quick Actions -->
    <div class="card p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-purple-600">bolt</span>
        </div>
        <h3 class="text-lg font-semibold text-slate-900">Quick Actions</h3>
      </div>
      
      <div class="space-y-3">
        <a href="tel://<%= @buyer.phone %>" class="flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:bg-green-50 hover:border-green-200 transition-colors group">
          <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center group-hover:bg-green-200 transition-colors">
            <span class="material-symbols-outlined text-green-600">call</span>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-slate-900">Call Buyer</p>
            <p class="text-xs text-slate-500"><%= @buyer.phone %></p>
          </div>
          <span class="material-symbols-outlined text-slate-400">arrow_forward</span>
        </a>
        
        <a href="https://wa.me/<%= @buyer.phone.gsub(/\D/, '') %>" target="_blank" class="flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:bg-green-50 hover:border-green-200 transition-colors group">
          <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center group-hover:bg-green-200 transition-colors">
            <span class="material-symbols-outlined text-green-600">chat</span>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-slate-900">WhatsApp</p>
            <p class="text-xs text-slate-500">Start conversation</p>
          </div>
          <span class="material-symbols-outlined text-slate-400">arrow_forward</span>
        </a>
        
        <a href="mailto:buyer@example.com" class="flex items-center gap-3 p-3 rounded-lg border border-slate-200 hover:bg-blue-50 hover:border-blue-200 transition-colors group">
          <div class="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center group-hover:bg-blue-200 transition-colors">
            <span class="material-symbols-outlined text-blue-600">email</span>
          </div>
          <div class="flex-1">
            <p class="text-sm font-semibold text-slate-900">Send Email</p>
            <p class="text-xs text-slate-500">Compose message</p>
          </div>
          <span class="material-symbols-outlined text-slate-400">arrow_forward</span>
        </a>
      </div>
    </div>

    <!-- Transaction Stats -->
    <div class="card p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-green-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-green-700">analytics</span>
        </div>
        <h3 class="text-lg font-semibold text-green-900">Transaction Summary</h3>
      </div>
      
      <div class="space-y-4">
        <div class="p-4 bg-white rounded-lg border border-green-100">
          <p class="text-xs text-slate-500 mb-1">Property Value</p>
          <p class="text-xl font-bold text-slate-900">₹<%= number_with_delimiter(@buyer.property.price) %></p>
        </div>
        <div class="p-4 bg-white rounded-lg border border-green-100">
          <p class="text-xs text-slate-500 mb-1">Sale Price</p>
          <p class="text-xl font-bold text-green-600">₹<%= number_with_delimiter(@buyer.sale_price) %></p>
        </div>
        <div class="p-4 bg-white rounded-lg border border-green-100">
          <p class="text-xs text-slate-500 mb-1">Transaction ID</p>
          <p class="text-sm font-mono font-semibold text-slate-900">#TRX-<%= @buyer.id.to_s.rjust(6, '0') %></p>
        </div>
      </div>
    </div>

    <!-- Timeline -->
    <div class="card p-6">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-blue-600">timeline</span>
        </div>
        <h3 class="text-lg font-semibold text-slate-900">Timeline</h3>
      </div>
      
      <div class="space-y-4">
        <div class="flex items-start gap-3">
          <div class="w-3 h-3 rounded-full bg-green-500 mt-1.5"></div>
          <div class="flex-1">
            <p class="text-sm font-medium text-slate-900">Buyer Registered</p>
            <p class="text-xs text-slate-500"><%= @buyer.created_at.strftime("%d %b %Y, %I:%M %p") %></p>
          </div>
        </div>
        
        <% if @buyer.purchase_date %>
          <div class="flex items-start gap-3">
            <div class="w-3 h-3 rounded-full bg-blue-500 mt-1.5"></div>
            <div class="flex-1">
              <p class="text-sm font-medium text-slate-900">Property Purchased</p>
              <p class="text-xs text-slate-500"><%= @buyer.purchase_date.strftime("%d %b %Y") %></p>
            </div>
          </div>
        <% end %>
        
        <div class="flex items-start gap-3">
          <div class="w-3 h-3 rounded-full bg-purple-500 mt-1.5"></div>
          <div class="flex-1">
            <p class="text-sm font-medium text-slate-900">Last Updated</p>
            <p class="text-xs text-slate-500"><%= @buyer.updated_at.strftime("%d %b %Y, %I:%M %p") %></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="card p-6 border-red-200 bg-red-50">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-red-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-red-700">warning</span>
        </div>
        <h3 class="text-lg font-semibold text-red-900">Danger Zone</h3>
      </div>
      <p class="text-sm text-red-800 mb-4">Deleting will mark the property as available again.</p>
      <%= button_to buyer_path(@buyer), 
          method: :delete, 
          class: "w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-red-300 rounded-lg text-red-700 font-medium hover:bg-red-100 transition-colors",
          data: { confirm: "Are you sure? This will mark the property as available." } do %>
        <span class="material-symbols-outlined">delete</span>
        Delete Buyer
      <% end %>
    </div>
  </div>
</div>
