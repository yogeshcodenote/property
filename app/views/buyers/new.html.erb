<div class="mb-8">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-bold tracking-tight text-slate-900">Register New Buyer</h2>
      <p class="text-slate-500 mt-1">Add a new buyer to your portfolio.</p>
    </div>
    <%= link_to buyers_path, class: "btn-secondary flex items-center gap-2" do %>
      <span class="material-symbols-outlined">arrow_back</span>
      Back to Buyers
    <% end %>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Main Form -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Buyer Information -->
    <div class="card p-6">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-green-600">person</span>
        </div>
        <h3 class="text-lg font-semibold text-slate-900">Buyer Information</h3>
      </div>
      
      <%= form_with model: @buyer, local: true, html: { class: "space-y-6" } do |f| %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              <span class="material-symbols-outlined text-sm align-middle">badge</span>
              Full Name <span class="text-red-500">*</span>
            </label>
            <%= f.text_field :name, 
                class: "input-field w-full", 
                placeholder: "e.g., Rajesh Kumar" %>
            <% if @buyer.errors[:name].any? %>
              <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">error</span>
                <%= @buyer.errors[:name].join(", ") %>
              </p>
            <% end %>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              <span class="material-symbols-outlined text-sm align-middle">phone</span>
              Phone Number <span class="text-red-500">*</span>
            </label>
            <%= f.telephone_field :phone, 
                class: "input-field w-full", 
                placeholder: "e.g., 9876543210" %>
            <% if @buyer.errors[:phone].any? %>
              <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">error</span>
                <%= @buyer.errors[:phone].join(", ") %>
              </p>
            <% end %>
          </div>
        </div>

        <!-- Property Selection -->
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">
            <span class="material-symbols-outlined text-sm align-middle">home</span>
            Property Purchased <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <%= f.collection_select :property_id, 
                @properties, 
                :id, 
                :title,
                { prompt: "Select an available property" },
                class: "input-field w-full appearance-none" %>
            <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none">
              expand_more
            </span>
          </div>
          <% if @buyer.errors[:property].any? %>
            <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
              <span class="material-symbols-outlined text-xs">error</span>
              <%= @buyer.errors[:property].join(", ") %>
            </p>
          <% end %>
          <div class="mt-2 flex items-center gap-2">
            <span class="material-symbols-outlined text-green-600 text-sm">info</span>
            <p class="text-xs text-slate-500">Only available properties are shown in the list</p>
          </div>
          
          <% if @properties.any? %>
            <div class="mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
              <p class="text-xs font-medium text-green-800 mb-2">
                <span class="material-symbols-outlined text-sm align-middle">check_circle</span>
                Available Properties (<%= @properties.count %>)
              </p>
              <div class="flex flex-wrap gap-2">
                <% @properties.take(5).each do |property| %>
                  <span class="inline-flex items-center gap-1 px-2 py-1 bg-white rounded text-xs text-green-700 border border-green-200">
                    <span class="material-symbols-outlined text-xs">location_on</span>
                    <%= property.plot_number %> - <%= property.colony_name %>
                  </span>
                <% end %>
                <% if @properties.count > 5 %>
                  <span class="text-xs text-slate-500">+<%= @properties.count - 5 %> more</span>
                <% end %>
              </div>
            </div>
          <% else %>
            <div class="mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
              <p class="text-xs text-yellow-800">
                <span class="material-symbols-outlined text-sm align-middle">warning</span>
                No available properties. Please add a property first.
              </p>
              <%= link_to new_property_path, class: "text-xs font-semibold text-green-600 hover:text-green-700 mt-1 inline-block" do %>
                <span class="material-symbols-outlined text-sm align-middle">add</span>
                Add New Property
              <% end %>
            </div>
          <% end %>
        </div>

        <!-- Sale Details -->
        <div class="card bg-slate-50 p-6 border-slate-200">
          <div class="flex items-center gap-3 mb-4">
            <span class="material-symbols-outlined text-green-600">payments</span>
            <h4 class="font-semibold text-slate-900">Sale Details</h4>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">
                <span class="material-symbols-outlined text-sm align-middle">currency_rupee</span>
                Sale Price <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">â‚¹</span>
                <%= f.number_field :sale_price, 
                    step: 0.01, 
                    class: "input-field w-full pl-8", 
                    placeholder: "e.g., 5000000" %>
              </div>
              <% if @buyer.errors[:sale_price].any? %>
                <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                  <span class="material-symbols-outlined text-xs">error</span>
                  <%= @buyer.errors[:sale_price].join(", ") %>
                </p>
              <% end %>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">
                <span class="material-symbols-outlined text-sm align-middle">calendar_today</span>
                Purchase Date
              </label>
              <%= f.date_field :purchase_date, 
                  class: "input-field w-full", 
                  value: Date.today %>
            </div>
          </div>
        </div>

        <!-- Customer Review -->
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">
            <span class="material-symbols-outlined text-sm align-middle">rate_review</span>
            Customer Review <span class="text-slate-400 font-normal">(Optional)</span>
          </label>
          <%= f.text_area :review, 
              rows: 4, 
              class: "input-field w-full", 
              placeholder: "Enter customer's feedback or review about their purchase experience..." %>
          <p class="mt-1 text-xs text-slate-500">Add a testimonial or notes about the buyer's experience</p>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center justify-end gap-4 pt-6 border-t border-slate-200">
          <%= link_to "Cancel", buyers_path, class: "btn-secondary" %>
          <%= f.submit "Register Buyer", class: "btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="space-y-6">
    <!-- Important Notice Card -->
    <div class="card p-6 bg-gradient-to-br from-red-50 to-orange-50 border-red-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-red-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-red-700">warning</span>
        </div>
        <h3 class="text-lg font-semibold text-red-900">Important Notice</h3>
      </div>
      <div class="p-4 bg-white rounded-lg border border-red-100 mb-4">
        <div class="flex items-start gap-3">
          <span class="material-symbols-outlined text-red-600 text-sm mt-0.5">info</span>
          <p class="text-sm text-red-800">
            <strong>Automatic Status Update:</strong> Registering a buyer will automatically mark the selected property as <span class="font-bold text-red-600">SOLD</span>.
          </p>
        </div>
      </div>
      <div class="space-y-2">
        <div class="flex items-center gap-2 text-sm text-red-700">
          <span class="material-symbols-outlined text-sm">check</span>
          Property status changes to Sold
        </div>
        <div class="flex items-center gap-2 text-sm text-red-700">
          <span class="material-symbols-outlined text-sm">check</span>
          Property removed from available list
        </div>
        <div class="flex items-center gap-2 text-sm text-red-700">
          <span class="material-symbols-outlined text-sm">check</span>
          Buyer linked to property record
        </div>
      </div>
    </div>

    <!-- Required Fields Card -->
    <div class="card p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-green-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-green-700">assignment</span>
        </div>
        <h3 class="text-lg font-semibold text-green-900">Required Fields</h3>
      </div>
      <p class="text-sm text-green-800 mb-4">Ensure all mandatory fields are completed</p>
      <div class="space-y-2">
        <div class="flex items-center gap-2 text-sm text-green-700">
          <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
          Buyer Full Name
        </div>
        <div class="flex items-center gap-2 text-sm text-green-700">
          <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
          Phone Number
        </div>
        <div class="flex items-center gap-2 text-sm text-green-700">
          <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
          Property Selection
        </div>
        <div class="flex items-center gap-2 text-sm text-green-700">
          <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
          Sale Price
        </div>
      </div>
    </div>

    <!-- Quick Tips Card -->
    <div class="card p-6 bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-blue-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-blue-700">lightbulb</span>
        </div>
        <h3 class="text-lg font-semibold text-blue-900">Quick Tips</h3>
      </div>
      <ul class="space-y-3">
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-blue-800">Verify the buyer's phone number before submitting</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-blue-800">Double-check the property selection</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-blue-800">Enter the actual sale price for accurate records</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-blue-800">Add a review for future reference</span>
        </li>
      </ul>
    </div>

    <!-- Next Steps Card -->
    <div class="card p-6 bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-purple-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-purple-700">rocket_launch</span>
        </div>
        <h3 class="text-lg font-semibold text-purple-900">Next Steps</h3>
      </div>
      <div class="space-y-3">
        <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-purple-100">
          <div class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center text-xs font-bold text-purple-700">1</div>
          <span class="text-sm text-purple-800">Register the buyer</span>
        </div>
        <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-purple-100">
          <div class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center text-xs font-bold text-purple-700">2</div>
          <span class="text-sm text-purple-800">Property marked as sold</span>
        </div>
        <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-purple-100">
          <div class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center text-xs font-bold text-purple-700">3</div>
          <span class="text-sm text-purple-800">Update colony map</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Add visual feedback for property selection
  document.querySelector('select[name="buyer[property_id]"]')?.addEventListener('change', function(e) {
    const selectedOption = this.options[this.selectedIndex];
    if (this.value) {
      const feedback = document.createElement('div');
      feedback.id = 'property-feedback';
      feedback.className = 'mt-3 p-3 bg-green-50 rounded-lg border border-green-200 flex items-center gap-3';
      feedback.innerHTML = `
        <span class="material-symbols-outlined text-green-600">check_circle</span>
        <div>
          <p class="text-sm font-medium text-green-900">Property Selected</p>
          <p class="text-xs text-green-700">${selectedOption.text}</p>
        </div>
      `;
      
      const existing = document.getElementById('property-feedback');
      if (existing) existing.remove();
      
      this.parentElement.appendChild(feedback);
    }
  });
</script>
