<div class="mb-8">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-bold tracking-tight text-slate-900">Edit Buyer</h2>
      <p class="text-slate-500 mt-1">Update buyer information and details.</p>
    </div>
    <div class="flex gap-3">
      <%= link_to buyer_path(@buyer), class: "btn-secondary flex items-center gap-2" do %>
        <span class="material-symbols-outlined">visibility</span>
        View Buyer
      <% end %>
      <%= link_to buyers_path, class: "btn-secondary flex items-center gap-2" do %>
        <span class="material-symbols-outlined">arrow_back</span>
        Back
      <% end %>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Main Form -->
  <div class="lg:col-span-2 space-y-6">
    <!-- Buyer Information -->
    <div class="card p-6">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-green-600">person</span>
        </div>
        <h3 class="text-lg font-semibold text-slate-900">Buyer Information</h3>
      </div>
      
      <%= form_with model: @buyer, local: true, html: { class: "space-y-6" } do |f| %>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              <span class="material-symbols-outlined text-sm align-middle">badge</span>
              Full Name <span class="text-red-500">*</span>
            </label>
            <%= f.text_field :name, 
                class: "input-field w-full", 
                placeholder: "e.g., Rajesh Kumar" %>
            <% if @buyer.errors[:name].any? %>
              <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">error</span>
                <%= @buyer.errors[:name].join(", ") %>
              </p>
            <% end %>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">
              <span class="material-symbols-outlined text-sm align-middle">phone</span>
              Phone Number <span class="text-red-500">*</span>
            </label>
            <%= f.telephone_field :phone, 
                class: "input-field w-full", 
                placeholder: "e.g., 9876543210" %>
            <% if @buyer.errors[:phone].any? %>
              <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                <span class="material-symbols-outlined text-xs">error</span>
                <%= @buyer.errors[:phone].join(", ") %>
              </p>
            <% end %>
          </div>
        </div>

        <!-- Property Selection -->
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">
            <span class="material-symbols-outlined text-sm align-middle">home</span>
            Property Purchased <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <%= f.collection_select :property_id, 
                @properties, 
                :id, 
                :title,
                { prompt: "Select a property" },
                class: "input-field w-full appearance-none" %>
            <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none">
              expand_more
            </span>
          </div>
          <% if @buyer.errors[:property].any? %>
            <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
              <span class="material-symbols-outlined text-xs">error</span>
              <%= @buyer.errors[:property].join(", ") %>
            </p>
          <% end %>
        </div>

        <!-- Sale Details -->
        <div class="card bg-slate-50 p-6 border-slate-200">
          <div class="flex items-center gap-3 mb-4">
            <span class="material-symbols-outlined text-green-600">payments</span>
            <h4 class="font-semibold text-slate-900">Sale Details</h4>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">
                <span class="material-symbols-outlined text-sm align-middle">currency_rupee</span>
                Sale Price <span class="text-red-500">*</span>
              </label>
              <div class="relative">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">₹</span>
                <%= f.number_field :sale_price, 
                    step: 0.01, 
                    class: "input-field w-full pl-8", 
                    placeholder: "e.g., 5000000" %>
              </div>
              <% if @buyer.errors[:sale_price].any? %>
                <p class="mt-1 text-sm text-red-600 flex items-center gap-1">
                  <span class="material-symbols-outlined text-xs">error</span>
                  <%= @buyer.errors[:sale_price].join(", ") %>
                </p>
              <% end %>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">
                <span class="material-symbols-outlined text-sm align-middle">calendar_today</span>
                Purchase Date
              </label>
              <%= f.date_field :purchase_date, 
                  class: "input-field w-full" %>
            </div>
          </div>
        </div>

        <!-- Customer Review -->
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-2">
            <span class="material-symbols-outlined text-sm align-middle">rate_review</span>
            Customer Review <span class="text-slate-400 font-normal">(Optional)</span>
          </label>
          <%= f.text_area :review, 
              rows: 4, 
              class: "input-field w-full", 
              placeholder: "Enter customer's feedback or review..." %>
          <p class="mt-1 text-xs text-slate-500">Add a testimonial or notes about the buyer's experience</p>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center justify-end gap-4 pt-6 border-t border-slate-200">
          <%= link_to "Cancel", buyers_path, class: "btn-secondary" %>
          <%= f.submit "Update Buyer", class: "btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Sidebar -->
  <div class="space-y-6">
    <!-- Buyer Preview Card -->
    <div class="card p-6 bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-blue-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-blue-700">preview</span>
        </div>
        <h3 class="text-lg font-semibold text-blue-900">Buyer Preview</h3>
      </div>
      <div class="flex items-center gap-3 mb-4 p-3 bg-white rounded-lg border border-blue-100">
        <div class="w-12 h-12 rounded-full bg-blue-200 flex items-center justify-center">
          <span class="text-sm font-bold text-blue-700"><%= @buyer.name.split.map(&:first).join %></span>
        </div>
        <div>
          <p class="font-semibold text-slate-900"><%= @buyer.name %></p>
          <p class="text-xs text-slate-500"><%= @buyer.phone %></p>
        </div>
      </div>
      <div class="space-y-2">
        <div class="p-3 bg-white rounded-lg border border-blue-100">
          <p class="text-xs text-slate-500 mb-1">Property</p>
          <p class="font-semibold text-slate-900 text-sm"><%= @buyer.property.title %></p>
          <p class="text-xs text-slate-500"><%= @buyer.property.plot_number %></p>
        </div>
        <div class="p-3 bg-white rounded-lg border border-blue-100">
          <p class="text-xs text-slate-500 mb-1">Sale Price</p>
          <p class="font-bold text-green-600">₹<%= number_with_delimiter(@buyer.sale_price) %></p>
        </div>
      </div>
    </div>

    <!-- Important Notice Card -->
    <div class="card p-6 bg-gradient-to-br from-yellow-50 to-amber-50 border-yellow-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-yellow-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-yellow-700">info</span>
        </div>
        <h3 class="text-lg font-semibold text-yellow-900">Important Note</h3>
      </div>
      <div class="p-3 bg-white rounded-lg border border-yellow-100">
        <div class="flex items-start gap-3">
          <span class="material-symbols-outlined text-yellow-600 text-sm mt-0.5">info</span>
          <p class="text-sm text-yellow-800">
            Changing the property will update the status of both old and new properties accordingly.
          </p>
        </div>
      </div>
    </div>

    <!-- Quick Tips Card -->
    <div class="card p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-green-200">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-10 h-10 bg-green-200 rounded-lg flex items-center justify-center">
          <span class="material-symbols-outlined text-green-700">lightbulb</span>
        </div>
        <h3 class="text-lg font-semibold text-green-900">Quick Tips</h3>
      </div>
      <ul class="space-y-3">
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-green-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-green-800">Verify buyer contact information</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-green-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-green-800">Keep sale price updated</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="material-symbols-outlined text-green-600 text-sm mt-0.5">verified</span>
          <span class="text-sm text-green-800">Add reviews for future reference</span>
        </li>
      </ul>
    </div>
  </div>
</div>
